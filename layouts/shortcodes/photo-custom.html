{{ $src := .Get "src" }}
{{ $captionParam := .Get "caption" | default "" }}
{{ $width := .Get "width" | default "50" }}

{{ $imagePath := $src | strings.TrimPrefix "/images-2/" | lower }}
{{ $imageData := index $.Site.Data.images $imagePath | default dict }}
{{ $jsonCaption := $imageData.caption | default "" }}
{{ $jsonAlt := $imageData.alt | default "" }}
{{ $jsonCopyright := $imageData.copyright | default "" }}
{{ $jsonCopyrightLink := $imageData.copyrightLink | default "" }}

{{ $finalCaption := cond (ne $jsonCaption "") $jsonCaption $captionParam }}
{{ $finalAlt := cond (ne $jsonAlt "") $jsonAlt $finalCaption }}

<div class="photo-custom-wrapper">
  <div class="photo-custom-container">
    <figure class="photo-block photo-custom" style="width: {{ $width }}%;">
      <img src="{{ $src }}" alt="{{ $finalAlt }}" />
    </figure>
    {{ if or (ne $finalCaption "") (ne $jsonCopyright "") }}
    <div class="photo-custom-caption">
      <span class="caption">
        {{ $finalCaption }}
        {{ if and (ne $finalCaption "") (ne $jsonCopyright "") }} | {{ end }}
        {{ if ne $jsonCopyright "" }}
          {{ if ne $jsonCopyrightLink "" }}
            <a href="{{ $jsonCopyrightLink }}" target="_blank">{{ $jsonCopyright }}</a>
          {{ else }}
            {{ $jsonCopyright }}
          {{ end }}
        {{ end }}
      </span>
    </div>
    {{ end }}
  </div>
</div>
